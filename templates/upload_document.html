<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nahrát dokument - Kancelářská automatizace</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">Kancelářská automatizace</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Domů</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('task.list_tasks') }}">Úlohy</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('document.list_documents') }}">Dokumenty</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('project.list_projects') }}">Projekty</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('chat.general_chat_page') }}">Chat</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('user.list_users') }}">Uživatelé</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Drobečková navigace -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Domů</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('document.list_documents') }}">Dokumenty</a></li>
                <li class="breadcrumb-item active" aria-current="page">Nahrát dokument</li>
            </ol>
        </nav>

        <h1 class="mb-4">Nahrát nový dokument</h1>

        <div class="card">
            <div class="card-body">
                <form id="document-upload-form" action="{{ url_for('document.upload_document') }}" method="POST" enctype="multipart/form-data">
                    <div class="mb-4">
                        <div class="upload-zone" id="upload-zone">
                            <i class="bi bi-cloud-arrow-up"></i>
                            <h3>Přetáhněte soubor sem</h3>
                            <p>nebo</p>
                            <div class="mb-3">
                                <input class="form-control" type="file" id="file-input" name="file">
                            </div>
                            <p class="text-muted small">Maximální velikost souboru: 50 MB</p>
                            <p class="text-muted small">Podporované formáty: PDF, DOCX, XLSX, CSV, TXT, JPG, PNG</p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="tags" class="form-label">Štítky (oddělené čárkou)</label>
                        <input type="text" class="form-control" id="tags" name="tags" placeholder="štítek1, štítek2, štítek3">
                        <div class="form-text">Volitelné. Pomáhá s organizací a vyhledáváním dokumentů.</div>
                    </div>

                    <div id="upload-progress" class="progress mb-4 d-none">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('document.list_documents') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left me-1"></i> Zpět na seznam
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-cloud-upload me-1"></i> Nahrát dokument
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-light py-3 mt-5">
        <div class="container text-center">
            <p class="text-muted mb-0">&copy; 2025 Kancelářská automatizace</p>
        </div>
    </footer>

    <!-- Přepínač tématu -->
    <div id="theme-toggle" class="theme-toggle" title="Přepnout téma">
        <i class="bi bi-moon-fill"></i>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Přidání funkcionality pro drag & drop
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('file-input');
        const uploadForm = document.getElementById('document-upload-form');
        const uploadProgress = document.getElementById('upload-progress');
        const progressBar = document.querySelector('.progress-bar');

        // Událost drag over
        uploadZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadZone.classList.add('active');
        });

        // Událost drag leave
        uploadZone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadZone.classList.remove('active');
        });

        // Událost drop
        uploadZone.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadZone.classList.remove('active');
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                
                // Zobrazení názvu souboru
                const fileName = fileInput.files[0].name;
                const fileSize = (fileInput.files[0].size / 1024 / 1024).toFixed(2);
                
                uploadZone.querySelector('h3').textContent = fileName;
                uploadZone.querySelector('p').textContent = `${fileSize} MB`;
            }
        });

        // Událost při změně souboru
        fileInput.addEventListener('change', function() {
            if (fileInput.files.length) {
                const fileName = fileInput.files[0].name;
                const fileSize = (fileInput.files[0].size / 1024 / 1024).toFixed(2);
                
                uploadZone.querySelector('h3').textContent = fileName;
                uploadZone.querySelector('p').textContent = `${fileSize} MB`;
            }
        });

        // Událost při odeslání formuláře
        uploadForm.addEventListener('submit', function(e) {
            // Kontrola, zda je vybrán soubor
            if (!fileInput.files.length) {
                e.preventDefault();
                alert('Prosím vyberte soubor k nahrání.');
                return;
            }
            
            // Kontrola velikosti souboru (max 50 MB)
            const maxSize = 50 * 1024 * 1024; // 50 MB
            if (fileInput.files[0].size > maxSize) {
                e.preventDefault();
                alert('Soubor je příliš velký. Maximální povolená velikost je 50 MB.');
                return;
            }
            
            // Zobrazení indikátoru nahrávání
            uploadProgress.classList.remove('d-none');
            simulateUploadProgress();
        });

        // Simulace průběhu nahrávání
        function simulateUploadProgress() {
            let progress = 0;
            const interval = setInterval(function() {
                progress += 5;
                progressBar.style.width = progress + '%';
                progressBar.setAttribute('aria-valuenow', progress);
                
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        }
    </script>
</body>
</html>